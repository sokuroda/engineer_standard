---
title: "engineer_kikaku"
output: html_document
date: "2023-08-31"
---

## データの読み込み
データフレームの変数は、規格のみとし、重複は除いた。
また、欠測値も目視で確認されたが、今回は、欠測値も除く。
```{r message=FALSE,warning=FALSE}
library(here)
library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(tidyverse)
```
```{r}
path <- here("data", "2023_06_16.csv")

df <- read_csv(
  path,
  locale = locale(encoding = "Shift-jis"),
  col_types = cols(.default = col_character())
) 
df <- df %>% 
  distinct(規格) %>% 
  drop_na(規格)
df
```

## パターンの把握

１ｇ
１％１ｇ
１ｍｇ１錠
１０ｍｇ１カプセル
０．１％１ｍＬ
１錠
欠測値
０．１％１２ｍＬ１包
３ｍｇ１．５ｍＬ１包
１０ｍｇ１ｍＬ（懸濁後の内用液として）
１０ｍｇ２．５ｍＬ１筒
５０単位１錠
１μｇ１ｇ
５０ｍｇ１丸
鉄１００ｍｇ１カプセル
カリウム４ｍＥｑ１ｇ
（１５０ｍｇ）１錠
１００ｍｇ１包（リンとして）
１０，０００単位１ｇ１包
３．７ＭＢｑ１カプセル
１００ＩＲ１錠
３，３００ＪＡＵ１錠
４０万単位１ｇ
１包
１５０万国際単位１錠
１０個
１袋
４００μｇ１本
（１８ｍｇ）３０．５ｍｍ×５０．０ｍｍ１枚
１枚
０．３８５４％８．９ｇ１缶
２５．６ｍｇ１個（１００μｇ）
０．０１４３％２．５ｍＬ１キット
５０μｇ６０ブリスター１キット
０．２５ｍｇ２ｍＬ１管
（２．１７ｍｇ）７．２５ｃ㎡１枚
ニューニット２．５ｃｍ×８．９ｃｍ
綿型５．１ｃｍ×２．５ｃｍ１枚
１患者当たり
散剤（液剤を含む）１ｇ
５モル２０ｍＬ１管
５，０００低分子ヘパリン国際単位１管
１袋１瓶１組
４０エルカトニン単位１ｍＬ１管
７．４ＧＢｑ２５ｍＬ１瓶
１ＫＥ１瓶
（Ａ．Ｂ．Ｅ型各１万単位Ｆ型４千単位）１瓶（溶解液付）
血液２００ｍＬに由来する赤血球に血漿約６０ｍＬを混和し
（人免疫グロブリン１２ｍｇヒスタミン二塩酸塩０．１５μ


## 完成形
まずは、加工後にどのような形にしたいのか明確にする。

### 単位当たりにする
多くは、【〇〇(g,%,L...)1(錠,瓶...)】という
ある単位当たりで重さや大きさが記されている。
そこで、これらを分ける必要がある。
ただし、イレギュラーとして、

①国際単位・単位がついている　例.「国際単位1(錠,瓶...)」
②単位が二つある　例.「単位１ｍＬ１管」
③1(錠,瓶...)が単位当たりではなく、規格そのものの場合

### 要検討
①の対処法は、filterで国際単位・単位を含むものだけ取りだして目視してから、
「国際単位・単位」の部分を削除する。
②の対処法は、該当数が少なければ、個別で対応すればよい。
③の対処法は、目視で確認。


### 規格について
今回の規格には多様な単位が用いられている。
「重さ(g)」「液量(L)」「大きさ(cm × cm, ㎤)」など。

### 検討しなければならない点
①　1つの医薬品に対し、複数の単位で記されている場合
　　「規格①」「規格②」のようにして分けた方が見やすいため、分ける。
　　「主要な単位(g,L,cm)で分解する」という関数を書けばい。
　　※ただし、漏れがでることが予想される。
　　　漏れ防止のため、テストを行い、漏れが出ないよう改良を重ねる

＜テストの手順＞
　1. データフレームを目視し、主要な単位を抽出する。
　
　2. 単位ごとの集計表を作成
　(集計する際に、単位として機能していない文字を抽出されないように
　「0~9の数字+単位」という形で集計する。)
　
　3. 集計表のどの単位にも属さない変数(漏れ変数)を目視し、
　考慮すべき変数を再度検討する。
　
　4. 漏れ変数がなくなるまで、手順2と3を繰り返し行う。
　
　　
②　単位の種類でカテゴリを分ける必要があるのか。
　　単位で分けると変数の数が増えてしまうため、分けない。
　　
以上をまとめると、以下のように分解・整理できるように加工を加える。

| 規格①      | 規格②          |単位当たり|
|-------------|-------------------|------------|
| １ｇ   　　　|　　　　　　　   |1錠|
| １ｍｇ　　　 | １カプセル |1カプセル|
| ０．１％  | １ｍＬ           |1g|
| ：  | ：           |：|

## 検証
＜規格①、規格②に対する検証＞
規格①、規格②でそれぞれに、考慮しなければならない単位が
1つ含まれているのかテストすればよい。
考慮すべき単位が含まれているか否かを

＜単位当たりに対する検証＞

＜全体を通しての検証＞


＜案①＞
規格①、規格②、単位当たりを統合して、
それが、規格と一致するのか検証する。

＜案②＞

echo "# engineer_standard" >> README.md
git init
git add README.md
git commit -m "first commit"
git branch -M main
git remote add origin https://github.com/sokuroda/engineer_standard.git
git push -u origin main
…or push an existing repository from the command line
git remote add origin https://github.com/sokuroda/engineer_standard.git
git branch -M main
git push -u origin main
…or import code from another repository
You can initialize this repository with code from a Subversion, Mercurial, or TFS project.












　　








